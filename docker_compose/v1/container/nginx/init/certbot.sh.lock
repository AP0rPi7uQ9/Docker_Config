#!/bin/sh
sleep 10
echo "Running Certbot.sh Successfuly."
###### Begin
sed -i -r 's/(listen .*443)/\1;#/g; s/(ssl_(certificate|certificate_key|trusted_certificate) )/#;#\1/g' /etc/nginx/sites-available/example1.com.conf
#sed -i -r 's/(listen .*443)/\1;#/g; s/(ssl_(certificate|certificate_key|trusted_certificate) )/#;#\1/g' /etc/nginx/sites-available/example2.com.conf
######  End
### Nginx Need start before reload Nginx
service nginx start
### Nginx Start
nginx -t && service nginx reload
###### Begin
certbot certonly --webroot -d "example1.com" -d "www.example1.com" --email Nlg5NuST@126.com -w /var/www/_letsencrypt -n --agree-tos --force-renewal
#certbot certonly --webroot -d "example2.com" -d "www.example2.com" --email Nlg5NuST@126.com -w /var/www/_letsencrypt -n --agree-tos --force-renewal
######  End
###### Begin
sed -i -r 's/#?;#//g' /etc/nginx/sites-available/example1.com.conf
#sed -i -r 's/#?;#//g' /etc/nginx/sites-available/example2.com.conf
######  End
nginx -t && service nginx reload
echo -e '#!/bin/bash\nnginx -t && service nginx reload' | tee /etc/letsencrypt/renewal-hooks/post/nginx-reload.sh
chmod a+x /etc/letsencrypt/renewal-hooks/post/nginx-reload.sh
nginx -t && service nginx reload
### Nginx Stop
service nginx stop
### Nginx Stop